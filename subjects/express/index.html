<!DOCTYPE html>
<html>
  <head>
    <title>Express (COMEM+ Web Dev)</title>
    <meta charset='utf-8'>
    <link rel='stylesheet' href='https://cdnjs.cloudflare.com/ajax/libs/unsemantic/1.1.3/unsemantic-grid-responsive.min.css'>
    <style>
      @import url(https://fonts.googleapis.com/css?family=Yanone+Kaffeesatz);
      @import url(https://fonts.googleapis.com/css?family=Droid+Serif:400,700,400i,700i);
      @import url(https://fonts.googleapis.com/css?family=Ubuntu+Mono:400,700,400i);

      body {
        font-family: 'Droid Serif';
      }

      h1, h2, h3, h4 {
        font-family: 'Yanone Kaffeesatz';
        font-weight: normal;
      }

      h4 {
        font-size: 30px;
        margin: 1em 0;
      }

      h1 strong, h2 strong, h3 strong, h4 strong, h5 strong, h6 strong {
        text-decoration: underline;
      }

      strong em {
        text-decoration: underline;
      }

      center {
        margin: 1em 0;
      }

      .remark-code, .remark-inline-code {
        font-family: 'Ubuntu Mono';
      }

      .remark-inline-code {
        padding: 0 2px;
        background-color: #eee;
        color: indianred;
        border-radius: 3px;
        border: thin solid #dddddd;
      }

      .remark-slide-scaler {
        overflow-y: scroll;
      }

      .container {
        clear: both;
      }

      .gitbashlogo {
        text-align: center;
      }

      .gitbashlogo > img {
        width: 80%;
      }

      ul li {
        margin-top: 0.4em;
      }

      table {
        width: 100%;
        border-collapse: collapse;
      }

      table th, td {
        padding: 0.2em;
      }

      table tbody th, td {
        border-top: 1px solid #c0c0c0;
      }

      blockquote {
        font-style: italic;
        border-left: 5px solid khaki;
        margin-left: 0;
        padding-left: 35px;
      }
    </style>
  </head>
  <body>
    <textarea id='source'>
# Express

Requirements:

* [Node.js][node] 4+
* [Google Chrome][chrome] (recommended, any browser with developer tools will do)
* [Postman][postman] (recommended, any tool that makes raw HTTP requests will do)





---
class: center, middle
## What is express?



A fast, unopinionated, **minimalist** web framework for Node.js



---
## Core functionality

.grid-33[

**Routing**

Map HTTP methods and URLs to controllers


]
.grid-33[

**Middleware**

Intercept and modify HTTP requests and responses


]
.grid-33[

**Template engines**

Render views with pluggable template engines


]
.container[

Express is **minimalist**: it doesn't provide much out of the box.
Use the many **middleware** packages at your disposal to build more complex applications.




]
---
### Install the express generator

You can create an express app from scratch, but we'll use **express-generator** to quickly create an application skeleton:

```bash
$> npm install -g express-generator
```

It provides the `express` command:

```bash
$> express --help

  Usage: express [options] [dir]

  Options:

    -h, --help           output usage information
        --version        output the version number
    -e, --ejs            add ejs engine support
        --pug            add pug engine support
        --hbs            add handlebars engine support
    -H, --hogan          add hogan.js engine support
    -v, --view <engine>  add view <engine> support (ejs|hbs|hjs|jade|pug|...
    -c, --css <engine>   add stylesheet <engine> support (less|stylus|...
        --git            add .gitignore
    -f, --force          force on non-empty directory
```



---
### Generate a skeleton application

```bash
$> cd /path/to/projects
$> express my-app

   create : my-app
   create : my-app/package.json
   create : my-app/app.js
   create : my-app/public
   create : my-app/public/javascripts
   create : my-app/public/images
   create : my-app/public/stylesheets
   create : my-app/public/stylesheets/style.css
   create : my-app/routes
   create : my-app/routes/index.js
   create : my-app/routes/users.js
   create : my-app/views
   create : my-app/views/index.jade
   create : my-app/views/layout.jade
   create : my-app/views/error.jade
   create : my-app/bin
   create : my-app/bin/www

   install dependencies:
     $ cd my-app && npm install

   run the app:
     $ DEBUG=my-app:* npm start
```



---
### Install dependencies and run it

As instructed, let's install the dependencies:

```bash
$> cd my-app
$> npm install
├─┬ body-parser@1.15.2
├─┬ cookie-parser@1.4.3
├─┬ debug@2.2.0
├─┬ express@4.14.1
│ ├─┬ ...
```

And run it:

```bash
$> DEBUG=my-app:* npm start

> my-app@0.0.0 start /path/to/projects/my-app
> node ./bin/www

  my-app:server Listening on port 3000 +0ms
```



---
### Browse the landing page

Visit [http://localhost:3000](http://localhost:3000) in your browser and you should see the app running:

<p class='center'><img src='images/express-running.png' width='60%' /></p>

In the terminal where you're running the app, you should also see that your request was **logged**:

```txt
  my-app:server Listening on port 3000 +0ms
GET / 200 321.805 ms - -
GET /stylesheets/style.css 200 2.457 ms - -
```



---
class: center, middle
## Application structure





---
### The server component

Let's take a look at the generated files:

```txt
package.json
app.js
routes
  index.js
  users.js
bin
  www
```

* `package.json` is used to track **dependencies** with npm
* `app.js` is the **main script** that will create and configure the express app
* `routes` contains files that define the app's **routes and controllers**
* `bin/www` is the **entrypoint** (the script you execute to launch the app)

The above files are executed **locally** on your machine when you develop,
or **on the server** when you deploy to a host.



---
### The client component

The rest of the files are:

```txt
views
  index.jade
  layout.jade
  error.jade
public
  javascripts
  images
  stylesheets
    style.css
```

* `views` contains the page templates (written in [Jade][jade] by default)
  that will be rendered to HTML by the server and served to the browser
* `public` contains **static files** that will be served to the browser

---
### The package.json file

Let's take a look at the generated `package.json`:

```json
{
  "name": "my-app",
  "version": "0.0.0",
  "private": true,
  "scripts": {
    "start": "node ./bin/www"
  },
  "dependencies": {
    "body-parser": "~1.16.0",
    "cookie-parser": "~1.4.3",
    "debug": "~2.6.0",
    "express": "~4.14.1",
    "jade": "~1.11.0",
    "morgan": "~1.7.0",
    "serve-favicon": "~2.3.2"
  }
}
```

* There is a **start script** configured to launch the app with `npm start`
* A few **dependencies** are pre-installed to provide basic web app functionality



---
## Express entry point (app.js)

TODO: adapt (content copied from previous course's slides)

* Dependencies
* npm packages
* local modules
* start the server
* async callback



---
## Express middleware

TODO: adapt (content copied from previous course's slides)

* Incoming HTTP requests can be processed by multiple components, organized in a pipeline
* The components can inspect and even modify the incoming HTTP requests and HTTP responses (think about security, compression, etc.).
* Express.js calls these components "middleware" functions
* Middleware can be chained. They can intercept requests at different levels (all requests, requests under a certain path, requests handled by a specific router, etc.)
* Built-in middleware components are available (in separate npm modules).
* We will use the express.static middleware to serve static content (e.g. HTML)

https://expressjs.com/en/guide/using-middleware.html

* Application-level vs. routing-level middleware vs. error-handling middleware



---
### Adding your own middleware

TODO: adapt (content copied from previous course's slides)

* after standard middleware
* before error handling



---
## Express routing

TODO: adapt (content copied from previous course's slides)

* Routing consists in finding some piece of code (a function) to execute when an HTTP request has been issued.
* We will see later (in a few weeks) that routing can happen on the client side. Today, we are looking at routing on the server side.
* Routing is part of the typical Model-View-Controller (MVC) pattern implemented by web frameworks (not only in JavaScript, but also in other languages). 
* Routing consists in finding the right controller when a request comes in. 
* The controller will then get a model and delegate the rendering of a view to a template engine.



---
### The home page

TODO: adapt (content copied from previous course's slides)

* Express router
* Add the router as middleware (filtered by path)
* Define a route: `GET /`



---
### Routing

TODO: adapt (content copied from previous course's slides)

https://expressjs.com/en/guide/routing.html

* Route methods (GET, POST, PUT)
* Route paths (`/`, `/home`, `/students`)
* Request and response objects



---
### Router

TODO: adapt (content copied from previous course's slides)

* For large applications, it is better to split the controllers in multiple, isolated components. You should use multiple routers for that purpose.
* express.Router() creates a new router. (no need for r = new Router())

https://expressjs.com/en/4x/api.html#router



---
## Resources

http://expressjs.com/en/4x/api.html



[chrome]: https://www.google.com/chrome/
[jade]: https://www.npmjs.com/package/jade
[node]: https://nodejs.org/en/
[postman]: https://www.getpostman.com

    </textarea>
    <script src='https://remarkjs.com/downloads/remark-latest.min.js'></script>
    <script>
      var slideshow = remark.create({
        navigation: {
          scroll: false
        },
        highlightLines: true,
        highlightSpans: true,
        countIncrementalSlides: false
      });
    </script>
  </body>
</html>
