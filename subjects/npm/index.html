<!DOCTYPE html>
<html>
  <head>
    <title>npm (COMEM+ Web Dev)</title>
    <meta charset='utf-8'>
    <link rel='stylesheet' href='https://cdnjs.cloudflare.com/ajax/libs/unsemantic/1.1.3/unsemantic-grid-responsive.min.css'>
    <style>
      @import url(https://fonts.googleapis.com/css?family=Yanone+Kaffeesatz);
      @import url(https://fonts.googleapis.com/css?family=Droid+Serif:400,700,400i,700i);
      @import url(https://fonts.googleapis.com/css?family=Ubuntu+Mono:400,700,400i);

      body {
        font-family: 'Droid Serif';
      }

      h1, h2, h3, h4 {
        font-family: 'Yanone Kaffeesatz';
        font-weight: normal;
      }

      h4 {
        font-size: 30px;
        margin: 1em 0;
      }

      h1 strong, h2 strong, h3 strong, h4 strong, h5 strong, h6 strong {
        text-decoration: underline;
      }

      strong em {
        text-decoration: underline;
      }

      center {
        margin: 1em 0;
      }

      .remark-code, .remark-inline-code {
        font-family: 'Ubuntu Mono';
      }

      .remark-inline-code {
        padding: 0 2px;
        background-color: #eee;
        color: indianred;
        border-radius: 3px;
        border: thin solid #dddddd;
      }

      .remark-slide-scaler {
        overflow-y: scroll;
      }

      .container {
        clear: both;
      }

      .gitbashlogo {
        text-align: center;
      }

      .gitbashlogo > img {
        width: 80%;
      }

      ul li {
        margin-top: 0.4em;
      }

      table {
        width: 100%;
        border-collapse: collapse;
      }

      table th, td {
        padding: 0.2em;
      }

      table tbody th, td {
        border-top: 1px solid #c0c0c0;
      }

      blockquote {
        font-style: italic;
        border-left: 5px solid khaki;
        margin-left: 0;
        padding-left: 35px;
      }
    </style>
  </head>
  <body>
    <textarea id='source'>
# npm





---
class: center, middle
## What is npm?



> "npm is the **package manager** for JavaScript. Find, share, and reuse packages of code from hundreds of thousands of developers — and assemble them in powerful new ways."



---
### Why use a package manager?

* Use code or applications that **other developers** have written to solve particular problems
* Regularly check if there are any **upgrades** and download them
* **Share** your own code with the community or **reuse** code across projects

<p class='center'><img src='images/shoulders-of-giants.jpg' width='100%' /></p>



---
### There are many package managers

For programming languages:

| Package manager | Language |
| :---            | :---     |
| Composer        | PHP      |
| Maven           | Java     |
| npm             | Node.js  |
| RubyGems        | Ruby     |
| pip             | Python   |

For operating systems:

| Package manager                   | OS                   |
| :---                              | :---                 |
| Advanced Package Tool (apt)       | Debian, Ubuntu       |
| Homebrew                          | Mac OS X             |
| Yellowdog Updater, Modified (yum) | RHEL, Fedora, CentOS |



---
### The npm registry

> "The [npm registry][npm] hosts over a quarter million packages of reusable code — the largest code registry in the world."

<img src='images/popular-packages.png' width='100%' />



---
### npm packages

An npm **package** or **module** is a basically:

* A directory with some files in it
* A [package.json][package.json] file with some metadata about the package:

```json
{
  "name": "my-project",
  "version": "1.3.2",
  "description": "It's great",
  "main": "index.js",
  "scripts": {
    "start": "node index.js"
  },
  "dependencies": {
    "express": "^4.13.3",
    "lodash": "~3.1.0"
  },
  "keywords": [ "awesome", "project" ],
  "author": "John Doe <john.doe@example.com>",
  "license": "MIT"
}
```



---
class: center, middle
## The npm command



npm is also a set of command line tools that work together with the registry.



---
### How do I use it?

```bash
$> npm help

Usage: npm <command>

where <command> is one of:
    access, adduser, bin, bugs, c, cache, completion, config,
    ddp, dedupe, deprecate, dist-tag, docs, edit, explore, get,
    `help`, help-search, i, `init`, `install`, install-test, it, link,
    list, ln, login, logout, ls, `outdated`, owner, pack, ping,
    prefix, prune, `publish`, rb, rebuild, repo, restart, root,
    `run`, run-script, s, se, search, set, shrinkwrap, star,
    stars, `start`, stop, t, tag, team, test, tst, un, uninstall,
    unpublish, unstar, up, update, v, version, view, whoami

npm <cmd> -h     quick help on <cmd>
npm -l           display full usage info
npm help <term>  search for help on <term>
npm help npm     involved overview
```



---
class: center, middle
## npm init



Create a new package



---
### Interactively create a package.json file

Create and move into a new project directory:

```bash
$> cd /path/to/projects
$> mkdir npm-demo
$> cd npm-demo
```

Run `npm init`:

```bash
$> npm init
This utility will walk you through creating a package.json file.
It only covers the most common items, and tries to guess sensible defaults.

...

Press ^C at any time to quit.
name: (npm-demo)
version: (1.0.0)
description: npm demo
entry point: (index.js)
test command:
git repository:
keywords: npm, demo
author: John Doe <john.doe@example.com>
license: (ISC)
```



---
### What it looks like

```json
{
  "name": "npm-demo",
  "version": "1.0.0",
  "description": "npm demo",
  "main": "index.js",
  "scripts": {
    "test": "echo \"Error: no test specified\" && exit 1"
  },
  "keywords": [ "npm", "demo" ],
  "author": "John Doe <john.doe@example.com>",
  "license": "ISC"
}
```

Read the [documentation][package.json] to find out everything you can configure in this file.



---
class: center, middle
## npm install



Install a package



---
### Installing packages

When you install a package, npm creates a `node_modules` directory where it saves the downloaded packages.

```bash
$> npm install lodash
npm-demo@1.0.0 /path/to/projects/npm-demo
└── lodash@4.17.4

$> ls
node_modules package.json

$> ls node_modules
lodash
```



---
### Using installed packages

Any script under the directory where `package.json` and  `node_modules` are can `require` the installed packages:

Create a `script.js` file next to `package.json`:

```js
const lodash = require('lodash');

let numbers = [ 1, 1, 2, 3, 2 ];
console.log(lodash.uniq(numbers));
```

Now run it:

```bash
$> node script.js
[ 1, 2, 3 ]
```

You have used the `uniq` function from the `lodash` package,
which returns an array with its duplicate elements removed.



---
### Tracking installed packages

Now remove the `node_modules` directory:

```bash
rm -fr node_modules
```

Your script should no longer work since the `lodash` package is no longer available:

```bash
$> node script.js
module.js:471
    throw err;
    ^

Error: Cannot find module 'lodash'
```



---
### The --save option

Adding the `--save` option will make npm track the dependency:

```bash
$> npm install --save lodash
npm-demo@1.0.0 /path/to/projects/npm-demo
└── lodash@4.17.4
```

A new `dependencies` section should have appeared in your `package.json` file:

```json
{
  "name": "npm-demo",
* "dependencies": {
*   "lodash": "^4.7.14"
* },
  ...
}
```



---
### npm install with a package.json

If you delete the `node_modules` directory again and run `npm install`:

```bash
$> rm -fr node_modules
$> npm install
npm-demo@1.0.0 /path/to/projects/npm-demo
└── lodash@4.17.4
```

npm has installed the `lodash` package again.

If you don't specify a package to install,
the install command will read the `package.json` and install the dependencies listed there.

Don't forget the `--save` option when adding dependencies to your project.
That way, other members of the team will just have to run `npm install`.



---
### The --save-dev and --production option

You often use two kinds of packages:

* Dependencies that your program or application needs to run (e.g. a database client)
* Development dependencies that you use during development but do not need to run the application (e.g. a live-reload server)

```bash
npm install --save-dev gulp
```

A `devDependencies` section will be added to your `package.json`:

```json
{
* "devDependencies": {
*   "gulp": "^0.9.0"
* }
  ...
}
```

* `npm install` - Install all dependencies (use when developing)
* `npm install --production` - Install only normal dependencies (use it to install on a server where you do not need your development tools)



---
### The --global option

Some packages can be installed **globally**.
Use the `--global` or `-g` option:

```bash
$> npm install --global http-server
```

If you get an `EACCES` error, you need to run `sudo npm install ...` or follow [this procedure][npm-fix-permissions].

Global packages usually provide a **command-line tool**.
In this case, the `http-server` package is a simple command-line HTTP server:

```bash
$> http-server
Starting up http-server, serving ./
Available on:
  http://127.0.0.1:8080
  http://10.178.123.132:8080
Hit CTRL-C to stop the server
```

---
#### Where are global packages installed?

Packages installed globally are **not** in a `node_modules` directory in your project.
They are local to your machine, and **are not saved as dependencies**.

Use `npm config` if you want to see where they are installed:

```bash
$> npm config get prefix
/usr/local

$> ls /usr/local/lib/node_modules
http-server
```



---
class: center, middle
## npm publish



Publish a package



---
### What do I need to publish?

You need a valid `package.json` file.

You should also set the `main` property:

```json
{
  "name": "npm-demo",
* "main": "./script.js",
  ...
}
```

When people `require` your module after installing it,
they will get the same result as if they had required that file.



---
### Publishing

Publishing is as simple as running the `npm publish` command in the directory where your `package.json` file is located:

```js
npm publish
```

You of course need an **npm account**.

You can only publish a new package if the package name is not already used.
Names are registered on a **first-come, first-serve** basis.



---
### Avoiding publication

Sometimes you write code that should not be published:

* A website (something where using `require` makes no sense)
* A private package with confidential information

In these cases, you can set the `private` property of the `package.json` file:

```json
{
  "name": "npm-demo",
* "private": true,
  ...
}
```

`npm publish` will then refuse to publish the package.



---
class: center, middle
## npm scripts



Running scripts with npm



---
### The scripts property

The `scripts` section of the `package.json` file defines scripts that can be run on the command line:

```json
{
  "name": "npm-demo",
* "scripts": {
*   "start": "node script.js"
* },
  ...
}
```

Here we define that running `npm start` should execute our script with Node.js:

```bash
$> npm start

> npm-demo@1.0.0 start /path/to/projects/npm-demo
> node script.js

[ 1, 2, 3 ]
```



---
### Lifecycle scripts

The following scripts are "standard" scripts:

| Script  | Purpose                              | Triggered by
| :---    | :---                                 | :---
| start   | Run your program                     | `npm start`
| stop    | Stop your program                    | `npm stop`
| restart | Restart your program                 | `npm restart`
| test    | Run automated tests for your program | `npm test`

Read the [documentation][npm-scripts] to see all the available lifecycle scripts.



---
### Custom scripts

You can also define your own custom scripts:

```json
{
  "name": "npm-demo",
* "scripts": {
*   "hello": "echo Hello World!"
* },
  ...
}
```

These scripts are run with `npm run <script>`:

```bash
$> npm run serve-static

> npm-demo@1.0.0 serve-static /path/to/projects/npm-demo
> echo Hello World!

Hello World!
```



---
### Scripts and the PATH

Package scripts (both lifecycle and custom scripts) have an interesting property:

* If you add packages that provide **command-line tools** as dependencies,
  their binaries will be **added to the PATH**.
* It's a way to add package dependencies that are normally installed globally,
  so that your team doesn't have to reinstall them on every machine.

---
#### Installing a "global" module as a dependency

Uninstall the global version of the static HTTP server we used earlier,
and install it as a development dependency instead:

```bash
$> npm uninstall --global http-server
$> npm install --save-dev http-server
```

You should no longer be able to run it:

```bash
$> http-server
http-server: command not found
```

Since it was not installed globally, its binary is **not in the PATH**.

---
#### Running a "global" module with a run script

However, if you put it in a custom package script:

```json
{
  "name": "npm-demo",
* "scripts": {
*   "serve-static": "http-server"
* },
  ...
}
```

It works because npm puts it in the PATH for you.

```bash
$> npm run serve-static

> npm-demo@1.0.0 serve-static /path/to/projects/npm-demo
> http-server

Starting up http-server, serving ./
Available on:
  http://127.0.0.1:8080
  http://10.192.112.121:8080
Hit CTRL-C to stop the server
```



---
## Resources

* Command line usage
  https://docs.npmjs.com/cli/npm
* package.json format
  https://docs.npmjs.com/files/package.json



[npm]: https://www.npmjs.com
[npm-fix-permissions]: https://docs.npmjs.com/getting-started/fixing-npm-permissions
[npm-scripts]: https://docs.npmjs.com/misc/scripts
[package.json]: https://docs.npmjs.com/files/package.json

    </textarea>
    <script src='https://remarkjs.com/downloads/remark-latest.min.js'></script>
    <script>
      var slideshow = remark.create({
        navigation: {
          scroll: false
        },
        highlightLines: true,
        highlightSpans: true,
        countIncrementalSlides: false
      });
    </script>
  </body>
</html>
