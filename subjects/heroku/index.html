<!DOCTYPE html>
<html>
  <head>
    <title>Heroku (COMEM+ Web Dev)</title>
    <meta charset='utf-8'>

    <link rel='stylesheet' href='../../assets/unsemantic-grid-base.css'>
    <link rel='stylesheet' href='../../assets/unsemantic-grid-desktop.css'>

    <link rel='stylesheet' href='../../assets/fonts/YanoneKaffeesatz/YanoneKaffeesatz.css'>
    <link rel='stylesheet' href='../../assets/fonts/DroidSerif/DroidSerif.css'>
    <link rel='stylesheet' href='../../assets/fonts/UbuntuMono/UbuntuMono.css'>

    <style>
      body {
        font-family: 'Droid Serif';
      }

      h1, h2, h3, h4 {
        font-family: 'Yanone Kaffeesatz';
        font-weight: normal;
      }

      h4 {
        font-size: 30px;
        margin: 1em 0;
      }

      h1 strong, h2 strong, h3 strong, h4 strong, h5 strong, h6 strong {
        text-decoration: underline;
      }

      .image-header h2, .image-header h3, .image-header h4, .image-header h5 .image-header h6 {
        display: none;
      }

      strong em {
        text-decoration: underline;
      }

      center {
        margin: 1em 0;
      }

      .remark-code, .remark-inline-code {
        font-family: 'Ubuntu Mono';
      }

      .remark-inline-code {
        padding: 0 2px;
        background-color: #eee;
        color: indianred;
        border-radius: 3px;
        border: thin solid #dddddd;
      }

      .container {
        clear: both;
      }

      ul li {
        margin-top: 0.4em;
      }

      table {
        width: 100%;
        border-collapse: collapse;
      }

      table th, td {
        padding: 0.2em 0.4em;
      }

      table tbody th, td {
        border-top: 1px solid #c0c0c0;
      }

      pre:first-child {
        margin-top: 0;
      }

      blockquote {
        font-style: italic;
        border-left: 5px solid khaki;
        margin-left: 0;
        padding-left: 35px;
      }

      .center blockquote {
        margin-right: 0;
        padding-right: 35px;
        border-right: 5px solid khaki;
      }

      #slide-logo {
        position: absolute;
        top: 0;
        left: 0;
      }

      #slide-logo img {
        height: 60px;
      }

      .breadcrumbs {
        position: absolute;
        top: 15px;
        left: 5.333em;
        font-size: 15px;
        color: #c0c0c0;
      }

      .breadcrumbs a {
        color: #c0c0c0;
        text-decoration: none;
      }

      .breadcrumbs a:hover {
        text-decoration: underline;
      }

      .center.middle .breadcrumbs {
        display: none;
      }

      #slide-links {
        position: absolute;
        top: 15px;
        right: 15px;
        font-size: 15px;
        text-align: right;
      }
    </style>
  </head>
  <body>

    <!-- Slides top-left logo -->
    <span id='slide-logo' style='display:none;'><img src='../heig.png' /></span>

    <!-- Slides top-right links -->
    <div id='slide-links' style='display:none;'>
      <!-- GitHub link -->
      <a href='https://github.com/MediaComem/comem-webdev/tree/8f1141b2839e958795aeabca7128249428ca5090/subjects/heroku/'><img src='../../assets/github.svg' width='24' height='24' alt='Source code' title='GitHub' /></a>
      <!-- Home link -->
      <a class='home-link' href='https://mediacomem.github.io/comem-webdev-docs/'><img src='../../assets/home.svg' width='24' height='24' alt='Home' title='Home' /></a>
    </div>

    <!-- Remark slides -->
    <textarea id='source'>
# Heroku

Requirements:

* [Git][git]
* A free [Heroku][heroku] account
* The [Heroku CLI][heroku-cli]
* [Node.js][node] 4+





---
class: center, middle, image-header
## What is Heroku?

.breadcrumbs[<a href="#1">Heroku</a>]



<p class='center'><img src='images/heroku.png' width='50%' /></p>

> Heroku is a cloud **Platform-as-a-Service (PaaS)** supporting several programming languages that is used as a **web application deployment** model.

> Heroku, one of the first cloud platforms, has been in development since June 2007, when it supported only the Ruby programming language, but now supports Java, **Node.js**, Scala, Clojure, Python, PHP, and Go.



---
### Cloud service models

.breadcrumbs[<a href="#1">Heroku</a> > <a href="#2">What is Heroku?</a>]

Cloud-computing providers offer their services according to **different models**, some of which are listed below:

| Service models                      | What they provide         | Examples                                 |
| :---                                | :---                      | :---                                     |
| [Infrastructure as a Service][iaas] | Servers, virtual machines | Amazon EC2, Azure (Microsoft), Rackspace |
| [*Platform as a Service*][paas]     | *Runtime environments*    | Heroku, OpenShift                        |
| [Software as a Service][saas]       | Online services           | Gmail                                    |
| [Functions as a Service][faas]      | Serverless environments   | Amazon Lambda, OpenWhisk (IBM)           |



---
### Infrastructure as a Service (IaaS)

.breadcrumbs[<a href="#1">Heroku</a> > <a href="#2">What is Heroku?</a>]

With traditional cloud providers, you have to **set up, maintain and operate** the **infrastructure** on which your applications are run.

<p class='center'><img src='images/iaas.png' width='70%' /></p>



---
### Platform as a Service (PaaS)

.breadcrumbs[<a href="#1">Heroku</a> > <a href="#2">What is Heroku?</a>]

The goal of PaaS platforms is to get **straight to building applications**.

<img src='images/paas.png' width='50%' />

* Higher-level programming
* Reduced complexity
* Effective deployment with built-in infrastructure
* Easier maintenance
* Scaling



---
### How does Heroku work?

.breadcrumbs[<a href="#1">Heroku</a> > <a href="#2">What is Heroku?</a>]

> Heroku runs your apps inside dynos — smart **containers** on a reliable, fully **managed runtime environment**.

> Developers deploy their **code** written in Node, Ruby, Java, PHP, Python, Go, Scala, or Clojure to a **build system** which produces an app that's ready for execution.

> The **system and language** stacks are **monitored, patched, and upgraded**, so it's always ready and up-to-date.



---
class: center, middle
## Getting started on Heroku with Node.js

.breadcrumbs[<a href="#1">Heroku</a>]



Deploy an express web app on Heroku



---
### Create an express app

.breadcrumbs[<a href="#1">Heroku</a> > <a href="#7">Getting started on Heroku with Node.js</a>]

Install **express-generator** if you haven't already:

```bash
npm install -g express-generator
```

Generate an app:

```bash
$> cd /path/to/projects
$> express heroku-demo
```

Make sure it works:

```bash
$> cd heroku-demo
$> npm install
$> npm start
```

Check that you can access it at [http://localhost:3000](http://localhost:3000).
Once you're sure it works, you can stop it with `Ctrl-C`.



---
### Make it a Git repository

.breadcrumbs[<a href="#1">Heroku</a> > <a href="#7">Getting started on Heroku with Node.js</a>]

Code is deployed on Heroku via Git.
Initialize a Git repository in the app's directory:

```bash
$> git init
```

Add a `.gitignore` file to ignore the `node_modules` directory
(dependencies will be installed by Heroku when you push):

```bash
$> echo node_modules > .gitignore
```

Your `.gitignore` file should look like this:

```txt
node_modules
```

Commit all the app's files:

```bash
$> git add --all
$> git commit -m "Initial commit"
```



---
### Create the app on Heroku

.breadcrumbs[<a href="#1">Heroku</a> > <a href="#7">Getting started on Heroku with Node.js</a>]

Heroku needs to know about your app:

```bash
$> heroku create
Enter your Heroku credentials.
Email: john.doe@example.com
Password (typing will be hidden):
Logged in as john.doe@example.com
Creating app... done, ⬢ nameless-depths-16198
https://nameless-depths-16198.herokuapp.com/
| https://git.heroku.com/nameless-depths-16198.git
```

Heroku has given a random name to your app.

Also notice that Heroku has added a **remote** named `heroku` to your Git repository:

```bash
$> git remote -v
heroku  https://git.heroku.com/nameless-depths-16198.git (fetch)
heroku  https://git.heroku.com/nameless-depths-16198.git (push)
```

Your app is now ready to deploy!



---
### Deploy it

.breadcrumbs[<a href="#1">Heroku</a> > <a href="#7">Getting started on Heroku with Node.js</a>]

Simply push to the new remote.
Notice that **as you push**, Heroku **automatically deploys** your app:

```bash
$> git push heroku master
Counting objects: 18, done.
Delta compression using up to 8 threads.
Compressing objects: 100% (14/14), done.
Writing objects: 100% (18/18), 3.83 KiB | 0 bytes/s, done.
Total 18 (delta 1), reused 0 (delta 0)
remote: Compressing source files... done.
remote: Building source:
remote: -----> `Node.js app detected`
remote: -----> Creating runtime environment
remote: -----> `Building dependencies`
remote:        Installing node modules (package.json)
remote:        heroku-demo@0.0.0 /tmp/build_c9758807eb8979e9eb8af687447e5985
remote:        ├─┬ body-parser@1.16.1
remote: -----> Launching...
remote:        `https://nameless-depths-16198.herokuapp.com/` deployed to Heroku
remote: Verifying deploy... done.
To https://git.heroku.com/nameless-depths-16198.git
 * [new branch]      master -> master
```

Visit the URL Heroku gives you to see your deployed app.



---
### How?

.breadcrumbs[<a href="#1">Heroku</a> > <a href="#7">Getting started on Heroku with Node.js</a>]

Heroku bases itself on the **conventions** of the language you're using.

For Node.js, it assumes:

* You are using npm and have a `package.json` file (that's how it **detects** that it's a Node.js app)
* Your dependencies are saved in it (Heroku will run `npm install`)
* You have a `start` script in your `package.json` (Heroku will run `npm start` to run your app)

Similar conventions exist for each language supported by Heroku (e.g. Java, PHP, Ruby).



---
### When do I pay?

.breadcrumbs[<a href="#1">Heroku</a> > <a href="#7">Getting started on Heroku with Node.js</a>]

By default, apps are deployed using a **free** Heroku dyno (or process).
Free dynos **sleep after 30 minutes of inactivity**,
or if you have exhausted your [pool of free dyno hours][free-dyno-hours] for the month.

When your app sleeps, it may take **several seconds** (up to a minute) for it start again before it can respond to requests.
It will then work normally until it goes to sleep again after prolonged inactivity.

Free Heroku dynos are suitable for **development** or **experimentation**, but **not for production** apps.

You can of course [pay][pricing] to get production-quality resources.



---
### Databases

.breadcrumbs[<a href="#1">Heroku</a> > <a href="#7">Getting started on Heroku with Node.js</a>]

Heroku provides several databases as addons, for example:

* [Heroku Postgres][heroku-postgres] (free version limited to 10,000 rows)
* [mLab MongoDB][mlab-mongodb] (free version limited to 496 MB)
* [Heroku Redis][heroku-redis] (free version limited to 25 MB)

The pricing model is usually similar to Heroku dynos:
there are free versions available that are restricted, but more powerful versions can be purchased.



---
## Resources

.breadcrumbs[<a href="#1">Heroku</a>]

* [Heroku dev center][dev-center]
* [Getting started on Heroku with Node.js][getting-started]



---
## TODO

.breadcrumbs[<a href="#1">Heroku</a>]

* configuration through environment variables



[dev-center]: https://devcenter.heroku.com
[faas]: https://en.wikipedia.org/wiki/Function_as_a_Service
[free-dyno-hours]: https://devcenter.heroku.com/articles/free-dyno-hours
[getting-started]: https://devcenter.heroku.com/articles/getting-started-with-nodejs#introduction
[git]: https://git-scm.com
[heroku]: https://www.heroku.com/home
[heroku-cli]: https://devcenter.heroku.com/articles/heroku-cli
[heroku-postgres]: https://devcenter.heroku.com/articles/heroku-postgresql
[heroku-redis]: https://devcenter.heroku.com/articles/heroku-redis
[iaas]: https://en.wikipedia.org/wiki/Cloud_computing
[mlab-mongodb]: https://devcenter.heroku.com/articles/mongolab
[node]: https://nodejs.org/en/
[paas]: https://en.wikipedia.org/wiki/Platform_as_a_service
[pricing]: https://www.heroku.com/pricing
[saas]: https://en.wikipedia.org/wiki/Software_as_a_service

    </textarea>

    <script src='../../assets/remark.min.js'></script>
    <script src='../../assets/jquery-3.1.1.slim.min.js' integrity='sha256-/SIrNqv8h6QGKDuNoLGA4iret+kyesCkHGzVUUV0shc=' crossorigin='anonymous'></script>
    <script src='../../assets/uri-1.18.7.js'></script>

    <script>
      var slideshow = remark.create({
        highlightLines: true,
        highlightSpans: true,
        countIncrementalSlides: false
      });

      $('#slide-links .home-link').each(function() {
        var $a = $(this);

        var queryParams = URI(window.location.href).search(true);
        if (!queryParams.home || typeof(queryParams.home) != 'string') {
          return;
        }

        if (queryParams.home.match(/^[a-z0-9\-\_\.]+\/[a-z0-9\-\_\.]+\/?$/i)) {
          $a.attr('href', 'https://github.com/' + queryParams.home);
        } else {
          $a.attr('href', queryParams.home);
        }
      });

      var slides = $('.remark-slide-content');

      // Remove logo from body and add it to each slide
      $('#slide-logo').remove().prependTo(slides).show();

      // Remove links from body and add them to each slide
      $('#slide-links').remove().prependTo(slides).show();

      // Make all external links open a new window
      $('a[href]').not('[href^="#"]').attr('target', '_blank');
    </script>
  </body>
</html>
