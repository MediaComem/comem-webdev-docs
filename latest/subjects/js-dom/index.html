<!DOCTYPE html>
<html>
  <head>
    <title>JavaScript - DOM API (COMEM+ Web Dev)</title>
    <meta charset='utf-8'>

    <link rel='stylesheet' href='../../assets/unsemantic-grid-base.css'>
    <link rel='stylesheet' href='../../assets/unsemantic-grid-desktop.css'>
    <link rel='stylesheet' href='../../assets/bootstrap-btn.css'>
    <link rel='stylesheet' href='https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css'>

    <link rel='stylesheet' href='../../assets/fonts/YanoneKaffeesatz/YanoneKaffeesatz.css'>
    <link rel='stylesheet' href='../../assets/fonts/DroidSerif/DroidSerif.css'>
    <link rel='stylesheet' href='../../assets/fonts/UbuntuMono/UbuntuMono.css'>

    <style>
      body {
        font-family: 'Droid Serif';
      }

      h1, h2, h3, h4 {
        font-family: 'Yanone Kaffeesatz';
        font-weight: normal;
      }

      h4 {
        font-size: 30px;
        margin: 1em 0;
      }

      h1 strong, h2 strong, h3 strong, h4 strong, h5 strong, h6 strong {
        text-decoration: underline;
      }

      .image-header h2, .image-header h3, .image-header h4, .image-header h5 .image-header h6 {
        display: none;
      }

      strong em {
        text-decoration: underline;
      }

      center {
        margin: 1em 0;
      }

      .remark-code, .remark-inline-code {
        font-family: 'Ubuntu Mono';
      }

      .remark-inline-code {
        padding: 0 2px;
        background-color: #eee;
        color: indianred;
        border-radius: 3px;
        border: thin solid #dddddd;
      }

      .remark-slide-content img {
        max-width: 100%;
      }

      .remark-slide-content p:first-child, .remark-slide-content ul:first-child {
        margin-top: 0;
      }

      .container {
        clear: both;
      }

      ul li {
        margin-top: 0.4em;
      }

      table {
        width: 100%;
        border-collapse: collapse;
      }

      table th, td {
        padding: 0.2em 0.4em;
      }

      table tbody th, td {
        border-top: 1px solid #c0c0c0;
      }

      pre:first-child, blockquote:first-child {
        margin-top: 0;
      }

      blockquote {
        font-style: italic;
        border-left: 5px solid khaki;
        margin-left: 0;
        padding-left: 35px;
      }

      .center blockquote {
        margin-right: 0;
        padding-right: 35px;
        border-right: 5px solid khaki;
      }

      #slide-logo {
        position: absolute;
        top: 0;
        left: 0;
      }

      #slide-logo img {
        height: 60px;
      }

      .breadcrumbs {
        position: absolute;
        top: 15px;
        left: 5.333em;
        font-size: 15px;
        color: #c0c0c0;
      }

      .breadcrumbs a {
        color: #c0c0c0;
        text-decoration: none;
      }

      .breadcrumbs a:hover {
        text-decoration: underline;
      }

      .center.middle .breadcrumbs {
        display: none;
      }

      #slide-links {
        position: absolute;
        top: 15px;
        right: 15px;
        font-size: 15px;
        text-align: right;
      }

      .w5 { width: 5%; }
      .w10 { width: 10%; }
      .w15 { width: 15%; }
      .w20 { width: 20%; }
      .w30 { width: 30%; }
      .w35 { width: 35%; }
      .w40 { width: 40%; }
      .w45 { width: 45%; }
      .w50 { width: 50%; }
      .w55 { width: 55%; }
      .w60 { width: 60%; }
      .w65 { width: 65%; }
      .w70 { width: 70%; }
      .w75 { width: 75%; }
      .w80 { width: 80%; }
      .w85 { width: 85%; }
      .w90 { width: 90%; }
      .w95 { width: 95%; }
      .w100 { width: 100%; }

      .x2 { font-size: 2em; }
      .x3 { font-size: 3em; }
      .x4 { font-size: 4em; }

      .compact-table table td {
        font-size: 0.9em;
      }

      .shadow {
        box-shadow: lightgrey 0 0 3px;
      }
      p.shadow { width: 100%; }
    </style>
  </head>
  <body>

    <!-- Slides top-left logo -->
    <span id='slide-logo' style='display:none;'><a href='http://www.heig-vd.ch/'><img src='../../assets/heig.png' /></a></span>

    <!-- Slides top-right links -->
    <div id='slide-links' style='display:none;'>
      <!-- GitHub link -->
      <a href='https://github.com/MediaComem/comem-webdev/tree/edaa8888ab85a46b10bc45cb68376f11660ce868/subjects/js-dom/'><img src='../../assets/github.svg' width='24' height='24' alt='Source code' title='GitHub' /></a>
      <!-- Home link -->
      <a class='home-link' href='https://mediacomem.github.io/comem-webdev-docs/'><img src='../../assets/home.svg' width='24' height='24' alt='Home' title='Home' /></a>
    </div>

    <!-- Remark slides -->
    <textarea id='source'>
# JavaScript - DOM API

This material is used in [COMEM+](http://www.heig-vd.ch/comem) [web development courses](https://github.com/MediaComem/comem-webdev).


Learn or rediscover how to use the DOM API to manipulate the underlying HTML object structure of a web page.

**You will need**

* [Google Chrome][chrome] (recommended, any browser with developer tools will do)
* [Sublime Text][sublime] (recommended, any code editor will do... **except Notepad**)

**Recommended reading**

* [Project setup][projset]
* [Bootstrap][bootstrap]
* [JavaScript][js-bas]



---
class: center, middle
## Starting file

.breadcrumbs[<a href="#1">JavaScript - DOM API</a>]

This subject will use [this `index.html` file][bsef] as illustration.

Be sure to download it, if you want to try and follow with the examples.



---
## Document Object Model (DOM)

.breadcrumbs[<a href="#1">JavaScript - DOM API</a>]

The Document Object Model (DOM) is a programming interface for **HTML, XML and SVG documents**. 

* provides a structured representation of the **document as a tree**
* defines methods that allow access to the tree, so that they can **change the document structure, style and content**
* provides a representation of the document as a structured group of **nodes and objects**, possessing various **properties and methods**
* allows **event handlers attached to nodes**, and once an event is triggered, the event handlers get executed. 

> Essentially, it connects web pages to scripts or programming languages. Although the DOM is often accessed using JavaScript, it is not a part of the JavaScript language.

---
### `Document` object and event handling

.breadcrumbs[<a href="#1">JavaScript - DOM API</a> > <a href="#3">Document Object Model (DOM)</a>]

The `Document` object is the first object of interest, and event handling is key to manage the interaction with the web page. Many possible events are fired during its life cycle and can be listened to.

Let's add the following `<script>` section in our `index.html` file:

> We know we shall avoid global variable, but for a small example like this, we can be tolerant ...

```js
<script type="text/javascript">
    var content = {
        alertText: "The document and all sub-resources have finished loading. The state 'complete' indicates that the load event is about to fire. ",
        alertLink: "https://developer.mozilla.org/fr/docs/Web/API/Document/readyState"
    }

    document.onreadystatechange = function () {
        if (document.readyState === "complete") {
            console.log(content.alertText);
        }
    }
</script>
```
> See also the [DOM documentation][domdoc] `Document.readyState`

???

The `Document.readyState` property of a document describes the loading state of the document.

---
### Example 1 - message alert

.breadcrumbs[<a href="#1">JavaScript - DOM API</a> > <a href="#3">Document Object Model (DOM)</a>]

We want to display a message alert on the top of the page as soon as the document is finished loading.

Let's add a dedicated function:
```js
function alertOnComplete() {
    var newDiv = document.createElement("div");
    newDiv.setAttribute("class", "alert alert-warning");
    var newText = document.createTextNode(content.alertText);
    newDiv.appendChild(newText);

    var mainContainer = document.getElementsByClassName("container").item(1);
    mainContainer.appendChild(newDiv);
}
```
> And just don't forget to call it in place of the `console.log`

The result does not completely satisfy the requirement. Indeed, the message alert is shown on the bottom of the page!

---
### Example 1 - display as the first child

.breadcrumbs[<a href="#1">JavaScript - DOM API</a> > <a href="#3">Document Object Model (DOM)</a>]

So what we have done is:

* `createElement`: we create a new `<div>` element
* `setAttribute`: we set a new `class` attribute to this `<div>` with the relevant class names
* `createTextNode`: we create a new text node with the message alert string
* `appendChild`: we "connect" the text node to the `<div>`
* `getElementsByClassName`: we get references to the elements having the `container` class
* `item`: we focus on the second container

But we want it on the top (just after the navigation bar). Just replace the last instruction with this one:

```js
mainContainer.insertBefore(newDiv, mainContainer.firstChild);
```
> There are even more methods like `removeChild` or `replaceChild` ...

---
### Example 1 - up to you!

.breadcrumbs[<a href="#1">JavaScript - DOM API</a> > <a href="#3">Document Object Model (DOM)</a>]

We have a second information in our `content.alertLink`, let's use it. 

Add a small **More info ...** link next to the displayed message alert. 

<img src='images/moreinfo.jpg' width='95%' />

---
### Example 2 - alignment buttons

.breadcrumbs[<a href="#1">JavaScript - DOM API</a> > <a href="#3">Document Object Model (DOM)</a>]

We want to enable these three alignment buttons we have in our user interface. Using them must align all `<p>` in the web page.

As previously, we need to add event listeners:

```js
function enableAlignmentButtons() {
    var buttons = document.getElementsByTagName("button");
    for (var i = 0; i < buttons.length; i++) {
        if (buttons.item(i).childNodes[0].nodeName === "SPAN") {
            buttons.item(i).addEventListener("click", alignAllText);
        }
    }
}
```
* `getElementsByTagName`: we get the references on all the `<button>` elements
* `childNodes`: for each of them, we access to the first child node
* `nodeName`: and we check if the child node is a `<span>`

> The fact is that we want to add a listener only on the alignment button (i.e. without the blue button). As soon as one of these buttons is clicked, the function `alignAllText` is called. Let's define it now!

---
### Example 2 - align each paragraph

.breadcrumbs[<a href="#1">JavaScript - DOM API</a> > <a href="#3">Document Object Model (DOM)</a>]

The last step is to capture what button the user has clicked on:

```js
function alignAllText(e) {
    var childNode = e.currentTarget.childNodes[0];
    var glyphClass = childNode.getAttribute("class");
    var align = String(glyphClass).substring(26, String(glyphClass).length);

    var ps = document.getElementsByTagName("p");
    for (var i = 0; i < ps.length; i++) {
        ps.item(i).classList.remove("text-left", "text-center", "text-right");
        ps.item(i).classList.add("text-" + align);
    }
}
```
* `e.currentTarget`: we get the object at the root of the event (clicked button)
* `getAttribute`: we get the class attribute to analyze
* `classList.remove`: for each paragraph, remove all alignment instructions 
* `classList.add`: for each paragraph, add the alignment to consider

> Of course, to make everything work, don't forget to call the `enableAlignmentButtons` function from the right place ...

---
### Exercice - up to you again!

.breadcrumbs[<a href="#1">JavaScript - DOM API</a> > <a href="#3">Document Object Model (DOM)</a>]

We want to play with the username/password form and the table we have in the user interface.

> Before we start, just replace the button of the first form like this:

```html
<input type="button" name="send" id="loginApp" value="Login" class="btn btn-success">
```
The requirement is: 
* as soon as the user does click the Login button, we add a row in the table using the information of the username and password input fields.
* you will discover how the use of ID values and the `getElementById` method are convenient

> Good luck! And to help you:

> At first add a function listener to the login button;

> Then give the logic to your function so as to get the values and create a new row with them.

---
## Resources

.breadcrumbs[<a href="#1">JavaScript - DOM API</a>]

You will find the final HTML file for this course [here][fef]

**Documentation**

* [DOM documentation][domdoc]

[domdoc]: https://developer.mozilla.org/en-US/docs/Web/API/Document_Object_Model
[bootstrap]: ../bootstrap
[js-bas]: ../js
[projset]: ../masrad-project-setup
[chrome]: https://www.google.com/chrome/
[sublime]: https://www.sublimetext.com/
[bsef]: https://gist.githubusercontent.com/Tazaf/18732ef01164f7b6348443c4c4748f42/raw/9f1dec778546a4d9741f1d17b08212c5606c26ca/index.html
[fef]: https://gist.githubusercontent.com/oertz/164a883774727e34fd9190e6abf84bd2
    </textarea>

    <script src='../../assets/remark.min.js'></script>
    <script src='../../assets/jquery-3.1.1.slim.min.js'></script>
    <script src='../../assets/uri-1.18.7.js'></script>

    <script>
      var remarkOptions = {"highlightLines":true,"highlightSpans":true,"countIncrementalSlides":false};
      var slideshow = remark.create(remarkOptions);

      $('#slide-links .home-link').each(function() {
        var $a = $(this);

        var currentUri = URI(window.location.href);
        var home = currentUri.search(true).home

        if (typeof(home) == 'string' && home.match(/^[a-z0-9\-\_\.]+\/[a-z0-9\-\_\.]+(?:#.*)?$/i)) {
          $a.attr('href', 'https://github.com/' + home);
        } else if (typeof(home) == 'string') {
          $a.attr('href', home);
        } else if (currentUri.hostname() == 'localhost') {
          $a.attr('href', currentUri.path('').hash('').toString());
        }
      });

      var slides = $('.remark-slide-content');

      // Remove logo from body and add it to each slide
      $('#slide-logo').remove().prependTo(slides).show();

      // Remove links from body and add them to each slide
      $('#slide-links').remove().prependTo(slides).show();

      // Make all external links open a new window
      $('a[href]').not('.home-link').not('[href^="#"]').attr('target', '_blank');
    </script>
  </body>
</html>
