<!DOCTYPE html>
<html>
  <head>
    <title>Angular UI Router (COMEM+ Web Dev)</title>
    <meta charset='utf-8'>

    <link rel='stylesheet' href='../../assets/unsemantic-grid-base.css'>
    <link rel='stylesheet' href='../../assets/unsemantic-grid-desktop.css'>
    <link rel='stylesheet' href='../../assets/bootstrap-btn.css'>
    <link rel='stylesheet' href='https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css'>

    <link rel='stylesheet' href='../../assets/fonts/YanoneKaffeesatz/YanoneKaffeesatz.css'>
    <link rel='stylesheet' href='../../assets/fonts/DroidSerif/DroidSerif.css'>
    <link rel='stylesheet' href='../../assets/fonts/UbuntuMono/UbuntuMono.css'>

    <style>
      body {
        font-family: 'Droid Serif';
      }

      h1, h2, h3, h4 {
        font-family: 'Yanone Kaffeesatz';
        font-weight: normal;
      }

      h4 {
        font-size: 30px;
        margin: 1em 0;
      }

      h1 strong, h2 strong, h3 strong, h4 strong, h5 strong, h6 strong {
        text-decoration: underline;
      }

      .image-header h2, .image-header h3, .image-header h4, .image-header h5 .image-header h6 {
        display: none;
      }

      strong em {
        text-decoration: underline;
      }

      center {
        margin: 1em 0;
      }

      .remark-code, .remark-inline-code {
        font-family: 'Ubuntu Mono';
      }

      .remark-inline-code {
        padding: 0 2px;
        background-color: #eee;
        color: indianred;
        border-radius: 3px;
        border: thin solid #dddddd;
      }

      .remark-slide-content img {
        max-width: 100%;
      }

      .remark-slide-content p:first-child, .remark-slide-content ul:first-child {
        margin-top: 0;
      }

      .container {
        clear: both;
      }

      ul li {
        margin-top: 0.4em;
      }

      table {
        width: 100%;
        border-collapse: collapse;
      }

      table th, td {
        padding: 0.2em 0.4em;
      }

      table tbody th, td {
        border-top: 1px solid #c0c0c0;
      }

      pre:first-child, blockquote:first-child {
        margin-top: 0;
      }

      blockquote {
        font-style: italic;
        border-left: 5px solid khaki;
        margin-left: 0;
        padding-left: 35px;
      }

      .center blockquote {
        margin-right: 0;
        padding-right: 35px;
        border-right: 5px solid khaki;
      }

      #slide-logo {
        position: absolute;
        top: 0;
        left: 0;
      }

      #slide-logo img {
        height: 60px;
      }

      .breadcrumbs {
        position: absolute;
        top: 15px;
        left: 5.333em;
        font-size: 15px;
        color: #c0c0c0;
      }

      .breadcrumbs a {
        color: #c0c0c0;
        text-decoration: none;
      }

      .breadcrumbs a:hover {
        text-decoration: underline;
      }

      .center.middle .breadcrumbs {
        display: none;
      }

      #slide-links {
        position: absolute;
        top: 15px;
        right: 15px;
        font-size: 15px;
        text-align: right;
      }

      .w5 { width: 5%; }
      .w10 { width: 10%; }
      .w15 { width: 15%; }
      .w20 { width: 20%; }
      .w30 { width: 30%; }
      .w35 { width: 35%; }
      .w40 { width: 40%; }
      .w45 { width: 45%; }
      .w50 { width: 50%; }
      .w55 { width: 55%; }
      .w60 { width: 60%; }
      .w65 { width: 65%; }
      .w70 { width: 70%; }
      .w75 { width: 75%; }
      .w80 { width: 80%; }
      .w85 { width: 85%; }
      .w90 { width: 90%; }
      .w95 { width: 95%; }
      .w100 { width: 100%; }

      .x2 { font-size: 2em; }
      .x3 { font-size: 3em; }
      .x4 { font-size: 4em; }

      .compact-table table td {
        font-size: 0.9em;
      }

      .shadow {
        box-shadow: lightgrey 0 0 3px;
      }
      p.shadow { width: 100%; }
    </style>
  </head>
  <body>

    <!-- Slides top-left logo -->
    <span id='slide-logo' style='display:none;'><a href='http://www.heig-vd.ch/'><img src='../../assets/heig.png' /></a></span>

    <!-- Slides top-right links -->
    <div id='slide-links' style='display:none;'>
      <!-- GitHub link -->
      <a href='https://github.com/MediaComem/comem-webdev/tree/e4fb5100b1bfa22ee84738dbf9c659be61ccd3ec/subjects/angular-ui-router/'><img src='../../assets/github.svg' width='24' height='24' alt='Source code' title='GitHub' /></a>
      <!-- Home link -->
      <a class='home-link' href='https://mediacomem.github.io/comem-webdev-docs/'><img src='../../assets/home.svg' width='24' height='24' alt='Home' title='Home' /></a>
    </div>

    <!-- Remark slides -->
    <textarea id='source'>
# Angular UI Router

Advanced routing for Angular applications.

This material is used in [COMEM+](http://www.heig-vd.ch/comem) [web development courses](https://github.com/MediaComem/comem-webdev).


**Recommended reading**

* [Angular](../angular/)





---
class: center, middle, image-header
## What is UI Router?

.breadcrumbs[<a href="#1">Angular UI Router</a>]



<p class='center'><img src='images/angular-ui-router.jpg' /></p>

Angular has a built-in router, [ngRoute][angular-router], but it's not very flexible.
[Angular UI router][angular-ui-router] is a community-developed alternative which is much more popular (and powerful).



---
## States

.breadcrumbs[<a href="#1">Angular UI Router</a>]

UI router is basically a [state machine][state-machine].
Think about each **page** of an application as a **set of states**:

.grid-40[

* Only **one state can be active at one time**
* The user can **transition from one state to another**, to activate a different page or feature of the application


]
.grid-60[

<p class='center'><img src='images/state-machine.png' class='w100' /></p>




]
---
### Defining states

.breadcrumbs[<a href="#1">Angular UI Router</a> > <a href="#3">States</a>]

You define states in an **Angular config function** by injecting the `$stateProvider` and calling its `state` function with **state definition objects**:

```js
angular.module('starter').config(function($stateProvider) {
  `$stateProvider.state`('homePage', {
    url: '/',
    templateUrl: 'templates/home.html',
    controller: 'HomePageController',
    controllerAs: 'homePageCtrl'
  });

  `$stateProvider.state`('itemsPage', {
    url: '/items',
    templateUrl: 'templates/items.html',
    controller: 'ItemsPageController',
    controllerAs: 'itemsPageCtrl'
  });
});
```



---
### State definition objects

.breadcrumbs[<a href="#1">Angular UI Router</a> > <a href="#3">States</a>]

Each state usually has at least:

* A `name`: this is the unique name of the state in the state machine
* An `url`: this is the URL that will trigger the state machine to **move to this state** when the user visits it
* A `template` or `templateUrl`: the **view** to display when the app is in that state
* A `controller`: the **logic** for that state's view

```js
$stateProvider.state(`'homePage'`, {
  `url`: '/',
  `templateUrl`: 'templates/home.html',
  `controller`: 'HomePageController',
  `controllerAs`: 'homePageCtrl'
});
```

---
#### Using components

.breadcrumbs[<a href="#1">Angular UI Router</a> > <a href="#3">States</a> > <a href="#5">State definition objects</a>]

You can also encapsulate your page into an **Angular component** and give that to UI router instead of the separate template and controller:

```js
angular.module('starter')`.component('HomePageComponent'`, {
  templateUrl: 'templates/home.html',
  controller: function() {
    // ...
  }
});

angular.module('starter').config(function($stateProvider) {
  $stateProvider.state(`'homePage'`, {
    `url`: '/',
    `component`: 'HomePageComponent'
  });
});
```



---
### Where does the template get inserted?

.breadcrumbs[<a href="#1">Angular UI Router</a> > <a href="#3">States</a>]

When a state is activated, its template is inserted into the `ui-view` of its parent state's template.
If it's a top-level state, its parent template is `index.html`:

```html
<body ng-app='myApp'>
  <div `ui-view` />
</body>
```

In some other frameworks using Angular UI router, this is a different directive (e.g. `<ion-nav-view>` in Ionic).



---
### Activating a state

.breadcrumbs[<a href="#1">Angular UI Router</a> > <a href="#3">States</a>]

There are **3 ways** to activate a state:

* Navigate to the `url` associated with the state
* Click a link containing the `ui-sref` directive
* Navigate programmatically by calling `$state.go()`

---
#### The `ui-sref` directive

.breadcrumbs[<a href="#1">Angular UI Router</a> > <a href="#3">States</a> > <a href="#8">Activating a state</a>]

The `ui-sref` directive (`sref` meaning **state reference**) allows you to make links to states instead of links to URLs.

**Instead of `href`**, you add the `ui-sref` attribute to a link:

```html
<a ui-sref='itemsPage'>Items</a>
```

Note that it references the **state name** (`itemsPage`), not the state's URL (`/items`).
It's good practice to use `ui-sref` instead of `href` everywhere in your app if you're using UI router.

---
#### Navigating programmatically

.breadcrumbs[<a href="#1">Angular UI Router</a> > <a href="#3">States</a> > <a href="#8">Activating a state</a>]

Sometimes you need to trigger a state transition in code.
You can inject UI router's `$state` service and call its `go()` function:

```js
angular.module('myApp').controller('MyCtrl', function($state) {
  var myCtrl = this;
  myCtrl.goToItems = function() {
    `$state.go('items');`
  };
});
```

Similarly to `ui-sref`, it takes the **state name** as an argument, not the state's URL.



---
### State parameters

.breadcrumbs[<a href="#1">Angular UI Router</a> > <a href="#3">States</a>]

Part of the URL is often dynamic, such as an item ID.
When configuring your state with `$stateProvider`, you can define **URL parameters** in state URLs like this:

```js
$stateProvider.state('itemDetailsPage', {
    url: '/items/`:itemId`',
    templateUrl: 'templates/itemDetails.html',
    controller: function(`$stateParams`) {
      var itemId = `$stateParams.itemId`;
    },
    controllerAs: 'itemDetailsCtrl'
  });
```

Note that you can inject the special `$stateParams` object;
its key and values are the URL parameters names and values, respectively.

---
#### Using state parameters when navigating

.breadcrumbs[<a href="#1">Angular UI Router</a> > <a href="#3">States</a> > <a href="#11">State parameters</a>]

You can specify the values of state parameters when navigating with `ui-sref` like this:

```html
<a ui-sref='itemDetailsPage`({ itemId: item.id })`'>{{ item.name }}</a>
```

Similarly with `$state.go()`:

```js
$state.go('itemDetailsPage', `{ itemId: item.id }`);
```



---
### The default state

.breadcrumbs[<a href="#1">Angular UI Router</a> > <a href="#3">States</a>]

When configuring your states, the `otherwise()` function of `$urlRouterProvider` allows you to navigate to default state when the URL does not match any defined state:

```js
$urlRouterProvider`.otherwise`(function($injector) {
  $injector.get('$state').go('itemsPage');
});
```



---
## TODO

.breadcrumbs[<a href="#1">Angular UI Router</a>]

* Resolve?
* Nested states
* Named views
* Transitions (blocking transitions)
* Better explain `ng-controller as` vs `controllerAs`



[angular-router]: https://docs.angularjs.org/api/ngRoute
[angular-ui-router]: https://ui-router.github.io
[state-machine]: https://en.wikipedia.org/wiki/Finite-state_machine

    </textarea>

    <script src='../../assets/remark.min.js'></script>
    <script src='../../assets/jquery-3.1.1.slim.min.js'></script>
    <script src='../../assets/uri-1.18.7.js'></script>

    <script>
      var remarkOptions = {"highlightLines":true,"highlightSpans":true,"countIncrementalSlides":false};
      var slideshow = remark.create(remarkOptions);

      $('#slide-links .home-link').each(function() {
        var $a = $(this);

        var currentUri = URI(window.location.href);
        var home = currentUri.search(true).home

        if (typeof(home) == 'string' && home.match(/^[a-z0-9\-\_\.]+\/[a-z0-9\-\_\.]+(?:#.*)?$/i)) {
          $a.attr('href', 'https://github.com/' + home);
        } else if (typeof(home) == 'string') {
          $a.attr('href', home);
        } else if (currentUri.hostname() == 'localhost') {
          $a.attr('href', currentUri.path('').hash('').toString());
        }
      });

      var slides = $('.remark-slide-content');

      // Remove logo from body and add it to each slide
      $('#slide-logo').remove().prependTo(slides).show();

      // Remove links from body and add them to each slide
      $('#slide-links').remove().prependTo(slides).show();

      // Make all external links open a new window
      $('a[href]').not('.home-link').not('[href^="#"]').attr('target', '_blank');
    </script>
  </body>
</html>
