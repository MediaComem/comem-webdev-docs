<!DOCTYPE html>
<html>
  <head>
    <title>jQuery - DOM Manipulation (COMEM+ Web Dev)</title>
    <meta charset='utf-8'>

    <link rel='stylesheet' href='../../assets/unsemantic-grid-base.css'>
    <link rel='stylesheet' href='../../assets/unsemantic-grid-desktop.css'>
    <link rel='stylesheet' href='../../assets/bootstrap-btn.css'>


    <link rel='stylesheet' href='../../assets/fonts/YanoneKaffeesatz/YanoneKaffeesatz.css'>
    <link rel='stylesheet' href='../../assets/fonts/DroidSerif/DroidSerif.css'>
    <link rel='stylesheet' href='../../assets/fonts/UbuntuMono/UbuntuMono.css'>

    <style>
      body {
        font-family: 'Droid Serif';
      }

      h1, h2, h3, h4 {
        font-family: 'Yanone Kaffeesatz';
        font-weight: normal;
      }

      h4 {
        font-size: 30px;
        margin: 1em 0;
      }

      h1 strong, h2 strong, h3 strong, h4 strong, h5 strong, h6 strong {
        text-decoration: underline;
      }

      .image-header h2, .image-header h3, .image-header h4, .image-header h5 .image-header h6 {
        display: none;
      }

      strong em {
        text-decoration: underline;
      }

      center {
        margin: 1em 0;
      }

      .remark-code, .remark-inline-code {
        font-family: 'Ubuntu Mono';
      }

      .remark-inline-code {
        padding: 0 2px;
        background-color: #eee;
        color: indianred;
        border-radius: 3px;
        border: thin solid #dddddd;
      }

      .remark-slide-content img {
        max-width: 100%;
      }

      .remark-slide-content p:first-child, .remark-slide-content ul:first-child {
        margin-top: 0;
      }

      .container {
        clear: both;
      }

      ul li {
        margin-top: 0.4em;
      }

      table {
        width: 100%;
        border-collapse: collapse;
      }

      table th, td {
        padding: 0.2em 0.4em;
      }

      table tbody th, td {
        border-top: 1px solid #c0c0c0;
      }

      pre:first-child {
        margin-top: 0;
      }

      blockquote {
        font-style: italic;
        border-left: 5px solid khaki;
        margin-left: 0;
        padding-left: 35px;
      }

      .center blockquote {
        margin-right: 0;
        padding-right: 35px;
        border-right: 5px solid khaki;
      }

      #slide-logo {
        position: absolute;
        top: 0;
        left: 0;
      }

      #slide-logo img {
        height: 60px;
      }

      .breadcrumbs {
        position: absolute;
        top: 15px;
        left: 5.333em;
        font-size: 15px;
        color: #c0c0c0;
      }

      .breadcrumbs a {
        color: #c0c0c0;
        text-decoration: none;
      }

      .breadcrumbs a:hover {
        text-decoration: underline;
      }

      .center.middle .breadcrumbs {
        display: none;
      }

      #slide-links {
        position: absolute;
        top: 15px;
        right: 15px;
        font-size: 15px;
        text-align: right;
      }

      .w5 { width: 5%; }
      .w10 { width: 10%; }
      .w15 { width: 15%; }
      .w20 { width: 20%; }
      .w30 { width: 30%; }
      .w35 { width: 35%; }
      .w40 { width: 40%; }
      .w45 { width: 45%; }
      .w50 { width: 50%; }
      .w55 { width: 55%; }
      .w60 { width: 60%; }
      .w65 { width: 65%; }
      .w70 { width: 70%; }
      .w75 { width: 75%; }
      .w80 { width: 80%; }
      .w85 { width: 85%; }
      .w90 { width: 90%; }
      .w95 { width: 95%; }
      .w100 { width: 100%; }

      .compact-table table td {
        font-size: 0.9em;
      }

      .shadow {
        box-shadow: lightgrey 0 0 3px;
      }
      p.shadow { width: 100%; }
    </style>
  </head>
  <body>

    <!-- Slides top-left logo -->
    <span id='slide-logo' style='display:none;'><a href='http://www.heig-vd.ch/'><img src='../../assets/heig.png' /></a></span>

    <!-- Slides top-right links -->
    <div id='slide-links' style='display:none;'>
      <!-- GitHub link -->
      <a href='https://github.com/MediaComem/comem-webdev/tree/3b33afa658276f2e6df806bbae5ddd5ccb8faf3a/subjects/jquery-dom-basics/'><img src='../../assets/github.svg' width='24' height='24' alt='Source code' title='GitHub' /></a>
      <!-- Home link -->
      <a class='home-link' href='https://mediacomem.github.io/comem-webdev-docs/'><img src='../../assets/home.svg' width='24' height='24' alt='Home' title='Home' /></a>
    </div>

    <!-- Remark slides -->
    <textarea id='source'>
# jQuery - DOM Manipulation

Learn how to use the jQuery library for manipulating the DOM of a WebPage and, thus, creating interactivity.

This material is used in [COMEM+](http://www.heig-vd.ch/comem) [web development courses](https://github.com/MediaComem/comem-webdev).


**You will need**

* [Google Chrome][chrome] (recommended, any browser with developer tools will do)
* [Sublime Text][sublime] (recommended, any code editor will do... **except Notepad**)
* [Live-Server][ls] (should already be installed)

**Recommended reading**

* [JavaScript][js]



---
class: center, middle, image-header
## What is jQuery

.breadcrumbs[<a href="#1">jQuery - DOM Manipulation</a>]



<p class='center'><img src='images/jquery-logo.png' width='30%' /></p>

> jQuery is a JavaScript (_hereafter JS_) library created in 2006 by John Resig, and originally designed to ease the creation of client-side JS script, especially regarding DOM manipulation.

> **This slide-deck is based on the `3.1.1` version of jQuery.**
> 
> **As such, some examples could be out-of-date.**

---
## Include jQuery

.breadcrumbs[<a href="#1">jQuery - DOM Manipulation</a>]

To add jQuery in your project, you can include it via a CDN link, in your `index.html` file:

```html
<body>
  ...
  <script src="https://code.jquery.com/jquery-3.1.1.min.js" integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8=" crossorigin="anonymous"></script>
</body>
```

You can also [download the complete file][dl-jquery], and save the file in a `js` directory in your project directory. Then, include the file in your `index.html`:

```html
<body>
  ...
  <script type="text/javascript" src="js/jquery-3.1.1.min.js"></script>
</body>
```
> Wait... am I not supposed to put my `<script>` tags in the `<head>`?
> 
> What are they doing right before the closing `</body>` tag?

---
### Script inclusions

.breadcrumbs[<a href="#1">jQuery - DOM Manipulation</a> > <a href="#3">Include jQuery</a>]

It's considered a good practice to include JS scripts **at the end of your HTML page**.

> When your browser loads the JS, it doesn't just load the file. It also **parses** it.

Parsing the JS files **pauses the load of all other resources**, effectively blocking everythig until the JS has been completely parsed.

> This can result in **slow loading pages**, especially when you have multiple or big scripts.

Plus, loading JS files while the DOM is not forces you to start all your JS scripts with the `window.onlad = function {}` syntax.

> With the `<script>` tag at the end of the HTML file, you can be sure that your JS is loaded **after** the DOM is.

---
### Add custom script

.breadcrumbs[<a href="#1">jQuery - DOM Manipulation</a> > <a href="#3">Include jQuery</a>]

We will write our own JS code in a custom script file.

In the `js` directory inside your project directory, create a new file `script.js` and include it at the bottom of your `index.html` page:

```html
<body>
  ...
  <script type="text/javascript" src="js/script.js"></script>
</body>
```
> Be extra-sure to include your custom `script.js` file **after** the inclusion of the jQuery file.

---
### Test everything

.breadcrumbs[<a href="#1">jQuery - DOM Manipulation</a> > <a href="#3">Include jQuery</a>]

Add the following line in your `script.js` file, and save it:

```js
console.log($("body").jquery);
```
Start your project with `live-server` and access your browser console. You should see the following lines:

```bash
3.1.1
Live reload enabled.
```
> If it's the case, you're good to go. jQuery and your custom script are both correctly include in your project.

---
class: center, middle
## jQuery documentation

.breadcrumbs[<a href="#1">jQuery - DOM Manipulation</a>]

Everything that is presented in this slide-deck can also be found in **the jQuery documentation**, along with lot of **examples** and **information**.

We highly recommend that you check it out.

[jQuery Documentation][jq-doc]



---
## The `$` object

.breadcrumbs[<a href="#1">jQuery - DOM Manipulation</a>]

The complete jQuery library is accessible in your JS code through the use of the global `$` variable.

> Some other libraries also offers a `$` variable as there main entry-point. That could be the cause for conflict between jQuery and those librairies.

If it's the case, you can use the global `jQuery` variable instead.

To be sure to remove all possible conflicts, you can use the special `.noConflict()` jQuery method at the top of your JS file:

```js
$.noConflict();
// Code that uses other library's $ can follow here.
// But use the jQuery variable to access jQuery's method.
```
> This shouldn't be the case in this course.

---
## Selecting things

.breadcrumbs[<a href="#1">jQuery - DOM Manipulation</a>]

Being a library designed to easily handle DOM manipulation, jQuery allows you to... easily select DOM elements.

The selection functionnality is **quite broad and powerful**, and is based on the **same syntax as CSS selectors**.

To select DOM elements and receive jQuery objects matching the selected elements, use the `$()` function, passing it a selector as parameter:

| Selector | CSS example | jQuery | Result |
| :------- | :----- | :---------- | :----- |
| Element  | `p` | `$("p")` | **All** `<p>` elements in the page |
| Id       | `#username` | `$("#username")` | **Unique** element with the `username` id |
| Class    | `.row` | `$(".row")` | **All** elements with a `row` class |

> Using a jQuery selector will always return you an `array` of jQuery objects, even with an Id selector (that should return one element).

---
### Good selecting practice

.breadcrumbs[<a href="#1">jQuery - DOM Manipulation</a> > <a href="#9">Selecting things</a>]

Selecting elements in jQuery being [very vast][css-select], you can easily write selectors that aren't optimals, performace-wise.

> Traversing the DOM is a **costly operation**. Your jQuery selectors (and your CSS ones as well) should try to be **as to-the-point as possible**.

There's many good practice regarding jQuery selectors. We are only going to see a few of them.

----

> Note that the following example contains some jQuery method.
> 
> **Don't mind them now, we will explicit these methods later on the course.**

---
#### Storing jQuery object

.breadcrumbs[<a href="#1">jQuery - DOM Manipulation</a> > <a href="#9">Selecting things</a> > <a href="#10">Good selecting practice</a>]

When you know or discover that your are going to use the same jQuery selector **several time**, you should cache its result **in a JS variable**, for future reference.

**Bad!**

```js
$("article > p:first-child").addClass("catch-phrase");
$("article > p:first-child").text("This is a very pertinent article");
$("article > p:first-child").append("<span>CLICK ME!</span>");
```
**Way better!**

```js
var `$firstSentences` = $("article > p:first-child");
`$firstSentences`.addClass("catch-phrase");
`$firstSentences`.text("This is a very pertinent article");
`$firstSentences`.append("<span>CLICK ME!</span>");
```
> For ease the reading of the code, it's a good practice to **precede** caching variable's name with **the `$` character**, to indicate that **it contains jQuery object(s)**.

---
#### Use `id` selectors

.breadcrumbs[<a href="#1">jQuery - DOM Manipulation</a> > <a href="#9">Selecting things</a> > <a href="#10">Good selecting practice</a>]

HTML `id` attribute allows you to define **unique identifier** in an HTML page.

Thanks to this uniqueness, element with `id` attributes are **extremly fast to retrieve** in the DOM, even with older browsers.

> As much as possible, you should add `id` attributes to HTML elements that you'll select.

```html
<div class="panel-body">
  <p><!-- content --></p>
  <p id="the-one"><!-- content --></p>
  <p><!-- content --></p>
</div>
```
This...
```js
$("#the-one")
```
...will be way faster than this.
```js
$("div.panel-body p:nth-of-type(2)")
```
---
#### Don't over do it

.breadcrumbs[<a href="#1">jQuery - DOM Manipulation</a> > <a href="#9">Selecting things</a> > <a href="#10">Good selecting practice</a>]

If you can't define `id` attributes in your HTML template, you'll need to use more complete selectors.

When doing so, you might be tempted to be **as exhaustive as possible**, in order to be sure you'll get the right element(s). Like this for example:

```js
$("html body main.container div.list-group a.list-group-item h4")
```
> This is completely **unnecessary** and a **waste of resources**.

You need to be precise with your selector to avoir selecting things you don't want. But being over-precise is **as bad** as being too vague.

> Knowing your HTML structure is **mandatory** when writing jQuery selectors.

We could simplify the precedent example like this:

```js
$("a.list-group-item h4")
```

---
#### Using `class` selector

.breadcrumbs[<a href="#1">jQuery - DOM Manipulation</a> > <a href="#9">Selecting things</a> > <a href="#10">Good selecting practice</a>]

CSS classes being shared among elements, it's a great way to quickly select all related elements.

```js
// Will select all items from list-group lists.
$(".list-group-item")
```
But there's a drawback.

With `class` selector, jQuery will parse **all the DOM** and test **every single node** to see if it has the given class (or classes). This is possibly very inefficient.

Thus, you should try to be **as precise as possible** when using `class` selector, by qualifying it with a tag name, for example.

In our example, we know that the `.list-group-item` should only be applied to `<li>` or `<a>` element. So:

```js
// Will select only <li> and <a> that have the class
$("li.list-group-item, a.list-group-item")
```
---
#### Selecting order

.breadcrumbs[<a href="#1">jQuery - DOM Manipulation</a> > <a href="#9">Selecting things</a> > <a href="#10">Good selecting practice</a>]

When jQuery encounters a selector like `$("a.list-group-item h4")`, how do you think it's going to execute it ?

> You might think that jQuery will fetch all the `a.list-group-item` first, then fetch all `h4` inside them.

This is **not** the case. In fact, it's the **complete opposite**.

To begin with, jQuery will fetch all `<h4>` in the page, and store them in an `array`.

Then, it will examine each of these `<h4>`, and reject the ones that don't have an `a.list-group-item` as parent.

> If you have many `<h4>` in your page or a far-too-precise selector, jQuery will take unnecessary time to process the selector.

To solve this problem, you have to options:
* Use the `.find()` method on the parent object.
* Narrow the context by using the second parameter of the `$()` function.

---
##### Try to `find()` me

.breadcrumbs[<a href="#1">jQuery - DOM Manipulation</a> > <a href="#9">Selecting things</a> > <a href="#10">Good selecting practice</a> > <a href="#15">Selecting order</a>]

The `find()` method allows you to search for **elements in the DOM**, but limited to the context of the jQuery object on which you called the method.

If we use the previous example again (the `$("a.list-group-item h4")` case), we would use the method like this:

```js
$("a.list-group-item").find("h4")
```
> We first fetch the `a.list-group-item`, then we search for `h4` elements **inside** the retrieved `a.list-group-item` elements.

---
##### Refine the use of `$()`

.breadcrumbs[<a href="#1">jQuery - DOM Manipulation</a> > <a href="#9">Selecting things</a> > <a href="#10">Good selecting practice</a> > <a href="#15">Selecting order</a>]

We said before that `$()` is the function to use to **retrieve DOM elements**.

Its first parameter is **the selector** for those elements.

But the function also have a second parameter, that is the **context in which the search is conducted**.

By default, the context is the complete HTML page, but you can pass it **any object representing a subset of the DOM**.

For the previous example, we could write our selector like this:

```js
// First, we retrieve all the list-group items
var $listElements = $("a.list-group-item");

// Then we search for <h4> element, but only in the subset of the Dom
// contained in the previously retrieved elements 
$("h4", $listElements)
```
In a more compressed style, it would resemble this:

```js
$("h4", $("a.list-group-item"))
```

---
class: center, middle
## Example file

.breadcrumbs[<a href="#1">jQuery - DOM Manipulation</a>]

The rest of this slide-deck will rely on [this `index.html` file][ex-file] as context.

Be sure to download it and place it in a new project directory (e.g. `jquery-course`), if you want to try and follow with the examples.

<p class="center"><img src="images/template.jpg" class="shadow" width="70%" /></p>

> Note that this example file includes Bootstrap through a CDN. Feel free to change that to a local link if you'd prefer ([see here][local-bs]).



---
## Learn by example

.breadcrumbs[<a href="#1">jQuery - DOM Manipulation</a>]

For the rest of this course, we are going to discover how to do things with jQuery by implementing features on the example template.

These features are:

* Select another discussion in the left list, and reset the unread indicator

* Change the alignment of the "New message" area, using the three buttons

* Add a new message to the discussion when clicking on the "Send" button

* Remove messages from the discussion when clicking on the trash button

---
class: center, middle
## Feature : *"Select discussion item"*

.breadcrumbs[<a href="#1">jQuery - DOM Manipulation</a>]



---
class: middle
### Template update N°1

.breadcrumbs[<a href="#1">jQuery - DOM Manipulation</a> > <a href="#20">Feature : *"Select discussion item"*</a>]

For **better UI behavior**, we need to tell our browser to show the **click pointer icon** when passing over our discussion list items.

Add this line in the `<style>` tag, after the `main` style:

```css
.list-group-item { cursor: pointer; }
```


---
### Events

.breadcrumbs[<a href="#1">jQuery - DOM Manipulation</a> > <a href="#20">Feature : *"Select discussion item"*</a>]

Most of the functionnalities we'll implement will rely on things being **clicked**.

> jQuery can handle more events than just click, [see here][jq-events].

Use the `click()` method to add a click event on an element. 

> The `click()` methid needs a callback function as its argument, that will be called with **one argument**: the **fired event**

In order to select another discussion, we need to add a `click` event to the **list elements**.

Add this code in your `script.js` file:

```js
$("a.list-group-item").click(function(event) {
  console.log(event);
});
```
Now, go to your page, open your console and try to **click** on one of the list item.

> You should see the object representing the event.

---
#### `this`? `$(this)`?

.breadcrumbs[<a href="#1">jQuery - DOM Manipulation</a> > <a href="#20">Feature : *"Select discussion item"*</a> > <a href="#22">Events</a>]

When writing event callback functions you might want to retrieve **the DOM element that triggered the event**.

You can do that with the property `currentTarget` of the event object:

```js
$("a.list-group-item").click(function(event) {
  console.log(`event.currentTarget`);
});
```
More simply, use the `this` keyword to achieve the **same purpose**:

```js
$("a.list-group-item").click(function(event) {
  console.log(`this`);
});
```
Since we are using jQuery, we'd prefer retrieving a **jQuery object** representing this DOM element.

Do that by passing `this` to the `$()` function:

```js
$("a.list-group-item").click(function(event) {
  console.log(`$(this)`);
});
```

---
### Add a CSS class

.breadcrumbs[<a href="#1">jQuery - DOM Manipulation</a> > <a href="#20">Feature : *"Select discussion item"*</a>]

On the page, there is one list item that has a different style.

This is **the currently selected item**, and the effect is achieved using the `.active` class from the Bootstrap framework.

When another list item will be clicked we want to **switch the active state** from the previous list item to the one being activated.

This means adding the `.active` CSS class **to the currently clicked element**.

Use the `.addClass()` method to do that, and pass it a `string` with the **name of the classes** to be added, separated by a **space**.

```js
$("a.list-group-item").click(function(event) {
  // Add the 'active' class to the clicked list item
* $(this).addClass("active");
});
```
> Go on your page, and click on your list items.

> The class is correctly added. Next step is to **remove this class** from the previsouly active element.

---
### Remove a CSS class

.breadcrumbs[<a href="#1">jQuery - DOM Manipulation</a> > <a href="#20">Feature : *"Select discussion item"*</a>]

To remove a CSS class from an element, simply use the `.removeClass()` method.

> Pass it a `string` argument with the names of the classes to be removed, separated by a space.

Now, we want to remove the active state from the previously selected list element.

This element is a `a.list-group-item` with the `.active` class.

```js
$("a.list-group-item").click(function(event) {
  // Remove the 'active' class from the previously selected list item
* $("a.list-group-item.active").removeClass("active");
  // Add the 'active' class to the clicked list item
  $(this).addClass("active");
});
```
> Note how we append the `.active` class to our selector.

Trying to remove a CSS class from an element that **didn't have it** in the first time will **not raise any error**, fortunately.

---
### Change the content

.breadcrumbs[<a href="#1">jQuery - DOM Manipulation</a> > <a href="#20">Feature : *"Select discussion item"*</a>]

Now that we can change the selected discussion list item, we want to **remove the notification** about unread messages, that is the badge in the item.

For that we will **change the content** of the `span.badge` inside the list item.

Use the `.text()` method to do so, and pass it as argument a `string` that represents the **new content**.

> Calling the method with **no argument** returns the **current** content.

In our case, since we want to remove the content of the element, we'll use an empty `string` (`""`):
```js
$("a.list-group-item").click(function(event) {
  /* Add this after previous code */

  // Remove the unread notification
* $("span.badge", this).text("");
});
```
> Note that we used the `this` keyword as context when searching for the `span.badge` element, since `this` represents the list item.

---
### Complete code

.breadcrumbs[<a href="#1">jQuery - DOM Manipulation</a> > <a href="#20">Feature : *"Select discussion item"*</a>]

Here's the complete code for this feature:
> For better readability and structure, we've splitted the **event declaration** from the **function implementation**.

```js
$("a.list-group-item").click(`switchListItem`);

function switchListItem() {

	// Change the active state to the clicked item
	$("a.list-group-item.active").removeClass("active");
	$(this).addClass("active");

	// Clear the unread notification for the clicked item
  $("span.badge", this).text("");
}
```

> Note that we passed the `switchListItem` function as parameter to the `.click()` method **without parenthesis**.

> We dont' want to **execute the function**, we just want to pass its **reference**.

---
class: center, middle
## Feature : *"Change message alignment"*

.breadcrumbs[<a href="#1">jQuery - DOM Manipulation</a>]



---
class: middle
### Template update N°2

.breadcrumbs[<a href="#1">jQuery - DOM Manipulation</a> > <a href="#28">Feature : *"Change message alignment"*</a>]

For the next feature, we will need to **add some `id`** in our `index.html` page.

At the **line 125**, add this `id` to the `<textarea>` element:

```html
&lt;textarea id="`message`" [...] &gt;&lt;/textarea&gt;
```

At the **line 127**, add this `id` to the `<div>` element:

```html
<div class="btn-group btn-group-sm" id="`align-btns`">
```



---
### Attach the events

.breadcrumbs[<a href="#1">jQuery - DOM Manipulation</a> > <a href="#28">Feature : *"Change message alignment"*</a>]

Our three alignment buttons are all children of the same element, which is the `div#align-btns`.

We can thus use this element in our selector to access the buttons:

```js
$("#align-btns button")...
```
> We have seen that this kind of notation can be optimized.
> 
> Let's use the second paramter of `$()` to retrieve the buttons, and then attach them the event:

```js
$("button", $("#align-btns")).click(function(event) {
  console.log(this);
});
```
> **"What is this strange behavior?"** you might say, **"The page is reload each time a button is clicked. Why?"**

---
#### Buttons in a form

.breadcrumbs[<a href="#1">jQuery - DOM Manipulation</a> > <a href="#28">Feature : *"Change message alignment"*</a> > <a href="#30">Attach the events</a>]

If you look closely to the HTML structure in which the `button`s are placed, you'll see that they are placed **inside a form**:

```html
*<form>
  <!-- textarea element -->
  <div class="btn-group btn-group-sm" id="align-btns">
    <button class="btn btn-default active">
      <span class="glyphicon glyphicon-align-left"></span>
    </button>
    <button class="btn btn-default">
      <span class="glyphicon glyphicon-align-center"></span>
    </button>
    <button class="btn btn-default">
      <span class="glyphicon glyphicon-align-right"></span>
    </button>
  </div>
  <!-- send button -->
*</form>
```
> Clicking on a `<button>` that's placed inside a `<form>` will trigger the submission of said `<form>`.

> **That's a default behavior that we don't want.**

---
### Prevent default behavior

.breadcrumbs[<a href="#1">jQuery - DOM Manipulation</a> > <a href="#28">Feature : *"Change message alignment"*</a>]

Remember that the **callback function** called when an event is triggered has one parameter, that is **the triggered event object** ?

This event object will **trigger the default behavior** attached to it **after** our code is executed, **unless we say it otherwise**.

The `.preventDefault()` method of the event object is rightly there for this purpose.

Let's call this method at the last line of our callback function:

```js
$("button", $("#align-btns")).click(function(event) {
  console.log(this);
  // Prevent the default submit behavior
* event.preventDefault();
});
```
> Clicking on the button will now no longer reload the page.

---
### Change button state

.breadcrumbs[<a href="#1">jQuery - DOM Manipulation</a> > <a href="#28">Feature : *"Change message alignment"*</a>]

The *align left* button is constantly in an active state. This effect is achieved by using the `.active` class from the Bootstrap framework.

In the same fashion as the state of the discussion list item, we will want to switch the state when a button is pressed.

This is the code that achieve that:

```js
$("button", $("#align-btns")).click(function(event) {
  // Change the active state when a button is clicked
* $("#align-btns").find("button.active").removeClass("active");
* $(this).addClass("active");
  
  // Prevent the default submit behavior
  event.preventDefault();
});
```
> Go on your page, and click on the alignment button, then click somewhere else, and **observe how your button react**.

> You should see that **its style changes**. On Chrome, when clicked, **a blue border is added**, that disappear when you click elsewhere.

---
### Managing the focus

.breadcrumbs[<a href="#1">jQuery - DOM Manipulation</a> > <a href="#28">Feature : *"Change message alignment"*</a>]

This is related to the **focus**, that is an indication of the element in the page that you're currently "using".

Focusing in or out of an element is an event to which you can react with JS and/or jQuery.

But you can also activate these event on elements within your code.

In our case, we want to focus out of the button once it has been clicked.

This event of focusing our an element is called `blur`, and can be activated by using the `.blur()` jQuery method:

```js
$("button", $("#align-btns")).click(function(event) {
  // Change the active state when a button is clicked
  $("button.active", $("#align-btns")).removeClass("active");
  $(this).addClass("active");
* $(this).blur();
  // Prevent the default submit behavior
  event.preventDefault();
});
```
---
### Chaining method calls

.breadcrumbs[<a href="#1">jQuery - DOM Manipulation</a> > <a href="#28">Feature : *"Change message alignment"*</a>]

In the previous code example, you might have seen that we called, one after the other, two different methods on the same object:

```js
  $(this).addClass("active");
  $(this).blur();
```
jQuery allows you to call **several methods on the same line**.

> This is called **method chaining**.

In our case, we can do that...

```js
  $(this).addClass("active").blur();
```
...because the `addClass()` returns the object that called it, here `$(this)`, on which we can call `.blur()` right away.

> You need to be aware of **what is returned** by each method if you want to use method chaining.

---
#### Be cautious

.breadcrumbs[<a href="#1">jQuery - DOM Manipulation</a> > <a href="#28">Feature : *"Change message alignment"*</a> > <a href="#35">Chaining method calls</a>]

Remember what the `.find()` method does?

```js
$("#align-buttons").find("button");
```

> The `.find()` method here will return all the `button` elements that it's found inside the `#align-buttons` element.

Thus, methods chained after a call to `.find()` will **not be applied** to the `$("#align-buttons")` object:

```js
$("#align-buttons").find("button")`.addClass("active")`;
```
> The `active` class will be applied to each objects returned from `.find()`.

If you'd want to apply the `.addClass()` method to the `$("#align-buttons")` object first, you'd need to write it like this:

```js
$("#align-buttons")`.addClass("active")`.find("button");
```

---
## Resources

.breadcrumbs[<a href="#1">jQuery - DOM Manipulation</a>]

**Documentation**

* [jQuery Documentation][jq-doc]
* [List of CSS selectors][css-select]

**Further reading**

* [Tips for good jQuery selectors][5-tips-selec]

[sublime]: https://www.sublimetext.com/
[chrome]: https://www.google.com/chrome/
[js]: ../js
[dl-jquery]: https://code.jquery.com/jquery-3.1.1.min.js
[ex-file]: https://gist.githubusercontent.com/Tazaf/2ca35d60688eec1281fd9546abe1f76a/raw/70c767db08e1e57b7db78df17258739d3ebeea2e/index.html
[jq-doc]: http://api.jquery.com/
[ls]: https://www.npmjs.com/package/live-server
[local-bs]: ../bootstrap-basics/#5
[css-select]: https://www.w3schools.com/cssref/css_selectors.asp
[5-tips-selec]: https://www.sitepoint.com/efficient-jquery-selectors/
[jq-events]: https://api.jquery.com/category/events/

---
## TODO

.breadcrumbs[<a href="#1">jQuery - DOM Manipulation</a>]

* Add `#align-btns` line 126
* Add `#send-btn` line 138
* Add `#dialog` line 74
* Add `#message` line 125
* Add `.list-group-item { cursor: pointer; }` line 15
* Add after line 162 :
```html
<!-- Templates -->
<div class="hidden" id="template-new-message">
  <div class="col-md-8 col-md-offset-4">
    <div class="alert alert-warning">
      <span class="message-text"></span>
      <div class="pull-right">
        <span class="small text-info"></span>
        <button class="btn btn-link btn-xs">
          <span class="glyphicon glyphicon-trash"></span>
        </button>
      </div>
    </div>
  </div>
</div>
```

---
## TOADD

.breadcrumbs[<a href="#1">jQuery - DOM Manipulation</a>]

* click() & events
* on() function and event on created DOM element
* $(this) VS this
* children()
* hasClass()
* e.preventDefault()
* blur() and event function
* removeClass() and addClass()
* hasClass()
* chaining method call
* parents() VS parent()
* fadeOut()
* remove()
* val()
* append()
* clone() and templating techniques
* text() VS html()
    </textarea>

    <script src='../../assets/remark.min.js'></script>
    <script src='../../assets/jquery-3.1.1.slim.min.js'></script>
    <script src='../../assets/uri-1.18.7.js'></script>

    <script>
      var remarkOptions = {"highlightLines":true,"highlightSpans":true,"countIncrementalSlides":false};
      var slideshow = remark.create(remarkOptions);

      $('#slide-links .home-link').each(function() {
        var $a = $(this);

        var currentUri = URI(window.location.href);
        var home = currentUri.search(true).home

        if (typeof(home) == 'string' && home.match(/^[a-z0-9\-\_\.]+\/[a-z0-9\-\_\.]+(?:#.*)?$/i)) {
          $a.attr('href', 'https://github.com/' + home);
        } else if (typeof(home) == 'string') {
          $a.attr('href', home);
        } else if (currentUri.hostname() == 'localhost') {
          $a.attr('href', currentUri.path('').hash('').toString());
        }
      });

      var slides = $('.remark-slide-content');

      // Remove logo from body and add it to each slide
      $('#slide-logo').remove().prependTo(slides).show();

      // Remove links from body and add them to each slide
      $('#slide-links').remove().prependTo(slides).show();

      // Make all external links open a new window
      $('a[href]').not('.home-link').not('[href^="#"]').attr('target', '_blank');
    </script>
  </body>
</html>
